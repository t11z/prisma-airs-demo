# DAG skeleton for Prisma AIRS-enabled chat flow.
# TODO: Wire actual node implementations and connections.

name: prisma-airs-chat
version: 0.1.0

description: |
  Placeholder DAG defining the high-level stages for input scanning, model invocation,
  and output validation with Prisma AIRS.

inputs:
  user_input:
    type: string
    description: Raw message from the end user.
  user_id:
    type: string
    description: Optional identifier to route Prisma AIRS policy decisions.
    default: ""

outputs:
  response_text:
    type: string
    description: Final assistant reply after scanning steps.
    value: ${response.output}

nodes:
  - name: user_input
    type: input
    description: Entry point for user-provided text.

  - name: airs_input_scan
    type: python
    source: ../tools/prisma_airs_scan.py
    function: scan_input
    description: Scan user input before the model.
    inputs:
      content: ${inputs.user_input}
      user_id: ${inputs.user_id}
    outputs:
      scan_result: ${output}

  - name: llm_call
    type: llm
    description: LLM invocation using Prisma AIRS-sanitized content.
    inputs:
      prompt: ${airs_input_scan.output.scanned_content}
    # TODO: Configure connection to the chosen model.
    # TODO: Bind prompt templates and additional input variables.

  - name: airs_output_scan
    type: python
    source: ../tools/prisma_airs_scan.py
    function: scan_output
    description: Scan model output before user delivery.
    inputs:
      content: ${llm_call.output}
      user_id: ${inputs.user_id}
    outputs:
      scan_result: ${output}

  - name: response
    type: output
    description: Final surface for delivering the assistant response.
    inputs:
      value: ${airs_output_scan.output.scanned_content}
